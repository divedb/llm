## 稀疏矩阵

#### 1. 简介

​	**Compressed Sparse Row (CSR)**是一种用于存储稀疏矩阵（Sparse Matrix）的高效数据结构。稀疏矩阵中大部分的元素是零，而CSR格式通过只存储非零元素以及它们的位置，大大节省了存储空间。

#### 2. CSR结构

​	CSR格式将一个稀疏矩阵分解成以下三个一维数组：

1.  **`values`**：
    -   存储矩阵中的所有非零元素，按行的顺序存储。
2.  **`col_index`**：
    -   存储每个非零元素对应的列索引，和`values`一一对应。
3.  **`row_ptr`**：
    -   存储每一行的非零元素在 `values` 数组中的起始位置。
    -   它的长度为行数+1，最后一个元素记录非零元素的总数。

**例子**

假设我们有一个稀疏矩阵：
$$
\begin{bmatrix} 0 & 0 & 1 & 0 \\ 2 & 0 & 3 & 4 \\ 0 & 0 & 0 & 5 \\ \end{bmatrix}
$$

1.  **`values`**：
    -   按行依次存储非零值：`[1, 2, 3, 4, 5]`
2.  **`col_index`**：
    -   对应的列索引：`[2, 0, 2, 3, 3]`
3.  **`row_ptr`**：
    -   每行非零元素的起始位置：
        -   第0行从第0个位置开始，有1个非零元素；
        -   第1行从第1个位置开始，有3个非零元素；
        -   第2行从第4个位置开始，有1个非零元素。
    -   因此：`[0, 1, 4, 5]`

总结后得到：

-   `values = [1, 2, 3, 4, 5]`
-   `col_index = [2, 0, 2, 3, 3]`
-   `row_ptr = [0, 1, 4, 5]`

**CSR 的优点**

1.  **节省内存**：只存储非零值及其位置信息。

2.  高效访问：

    -   按行访问时非常高效，因为`row_ptr`提供了每行的起始位置。
-   可结合算法快速实现矩阵向量乘法（SpMV）。

**CSR 的缺点**

1.  动态更新复杂：

    -   添加或删除元素可能需要移动大量数据，不适合频繁修改的场景。

2.  按列访问不方便：

    -   CSR 格式优化了按行存取，但按列存取效率较低。

#### 3. 应用场景

CSR 格式广泛用于：

1.  **科学计算和工程计算**：处理稀疏矩阵，节约存储和提高计算效率。
2.  **图计算**：存储图的邻接矩阵（稀疏矩阵），进行图遍历和路径搜索。
3.  **机器学习**：在推荐系统中存储稀疏用户-物品交互矩阵。
4.  **高性能计算（HPC）**：稀疏矩阵向量乘法（SpMV）、稀疏矩阵乘法（SpMM）等操作。



#### **CSC**

1.  **`values`**: 存储所有非零元素的数值。
2.  **`row_index`**: 非零元素对应的行索引。
3.  **`col_pointer`**: 每列第一个非零元素在 `values` 中的起始位置（最后一个元素指向总元素数）。

示例：

```
text


复制代码
矩阵:
[ 10  0  0  0 ]
[  0  0 20 30 ]
[  0  0  0 40 ]

CSC 表示:
values      = [10, 20, 30, 40]
row_index   = [0, 1, 1, 2]
col_pointer = [0, 1, 1, 3, 4]
```

------

### 3. **访问性能**

| 操作类型                | **CSR 优势**                 | **CSC 优势**                        |
| ----------------------- | ---------------------------- | ----------------------------------- |
| **行遍历**              | 快速                         | 较慢                                |
| **列遍历**              | 较慢                         | 快速                                |
| **矩阵向量乘法 (SpMV)** | y=A⋅xy = A \cdot xy=A⋅x 快速 | y=A⊤⋅xy = A^\top \cdot xy=A⊤⋅x 快速 |
| **矩阵转置存储效率**    | 需要转换为 CSC               | 自然适合存储转置矩阵                |

------

### 4. **应用场景**

-   **CSR**
    -   用于矩阵向量乘法（稀疏矩阵-稠密向量，SpMV）。
    -   遍历稀疏矩阵的行操作。
    -   适合左乘稀疏矩阵的算法。
-   **CSC**
    -   用于矩阵列操作（如列压缩或列提取）。
    -   遍历稀疏矩阵的列操作。
    -   适合右乘稀疏矩阵的算法。

------

### 5. **转换方式**

将 CSR 转换为 CSC 或反之：

1.  遍历原始矩阵的所有非零元素。
2.  重组 `values` 和索引数组（`row_index`/`col_index` 和 `row_pointer`/`col_pointer`）。
3.  时间复杂度为 O(非零元素数+行/列数)O(\text{非零元素数} + \text{行/列数})O(非零元素数+行/列数)。

------

**总结：**

-   CSR 优化**行操作**，如矩阵向量乘法 (y=A⋅xy = A \cdot xy=A⋅x)。
-   CSC 优化**列操作**，如列遍历或右乘向量 (y=A⊤⋅xy = A^\top \cdot xy=A⊤⋅x)。









